@use '../../node_modules/@angular/material/index' as mat;
@use './theme-colors' as my-theme;

@include mat.core();

html {
  @include mat.theme((
    color: (
      theme-type: light,
      primary: my-theme.$primary-palette,
    ),
    typography: Roboto,
    density: 0,
  ));

  @include mat.datepicker-overrides((
    calendar-container-background-color: #fff,
  ));

  @include mat.tabs-overrides((
    divider-color: transparent,
  ));

  @include mat.form-field-overrides((
    outlined-outline-width: 0,
    outlined-focus-outline-width: 0,
    outlined-input-text-color: #414141,
    outlined-input-text-placeholder-color: #41414170,
    select-option-text-color: #414141,
    enabled-select-arrow-color: #6B7280,
    focus-select-arrow-color: #6B7280,
    container-text-size: 14px,
    subscript-text-size: 14px,
  ));
}

@import "../../node_modules/tailwindcss";

/* === Design tokens === */
@theme static {
  --color-primary: var(--mat-sys-primary);
  --color-secondary: var(--mat-sys-secondary);
}

/* === Base (layout & defaults) === */
.mat-mdc-form-field {
  background-color: white !important;
}

html, body {
  height: 100%;
}

body {
  margin: 0;
  font-family: Roboto, "Helvetica Neue", sans-serif;
}

/* === Select (trigger & panel) === */
.unified-field .mat-mdc-select-min-line,
.unified-field .mat-mdc-select-value-text,
.unified-field .mat-mdc-select-placeholder {
  font: 400 0.875rem/2.5rem var(--mat-sys-typescale-body-medium-font, Roboto, Arial, sans-serif) !important;
  color: #414141 !important;
}

.cdk-overlay-pane .mat-mdc-select-panel {
  background-color: white !important;
}

.cdk-overlay-pane .mat-mdc-select-panel .mat-mdc-option {
  font-size: 0.875rem !important;
  line-height: 2rem !important;
  color: #1f1b14 !important;
}

.cdk-overlay-pane .mat-mdc-select-panel .mat-mdc-option .mdc-list-item__primary-text {
  font-size: inherit !important;
  line-height: inherit !important;
  color: inherit !important;
}

.cdk-overlay-pane .mat-mdc-select-panel .mat-mdc-option * {
  font-size: inherit !important;
  line-height: inherit !important;
}

.cdk-overlay-pane .mat-mdc-select-panel .mat-mdc-option .mdc-list-item__primary-text {
  display: flex;
  align-items: center;
  gap: .25rem;
}

.cdk-overlay-pane .mat-mdc-select-panel .mat-mdc-option mat-icon {
  font-size: 1.25rem !important;
  width: 1.25rem !important;
  height: 1.25rem !important;
  line-height: 1 !important;
  flex: 0 0 auto;
}

/* === Autocomplete (same style as select) === */
.cdk-overlay-pane .mat-mdc-autocomplete-panel {
  background-color: white !important;
}

.cdk-overlay-pane .mat-mdc-autocomplete-panel .mat-mdc-option {
  font-size: 0.875rem !important;
  line-height: 2rem !important;
  color: #1f1b14 !important;
}

.cdk-overlay-pane .mat-mdc-autocomplete-panel .mat-mdc-option .mdc-list-item__primary-text {
  font-size: inherit !important;
  line-height: inherit !important;
  color: inherit !important;
}

.cdk-overlay-pane .mat-mdc-autocomplete-panel .mat-mdc-option * {
  font-size: inherit !important;
  line-height: inherit !important;
}

.cdk-overlay-pane .mat-mdc-autocomplete-panel .mat-mdc-option .skill-category-label {
  font-size: 12px !important;
  line-height: 1.1 !important;
}

/* === Form field (global style) === */
:root {
  --ff-h: 2.5rem;
  --ff-radius: 8px;
  --ff-bg: #ffffff;
  --ff-border: #D1D5DB;
  --ff-border-focus: #9CA3AF;
  --ff-fs: 0.875rem;
  --ff-text: #414141;
  --ff-icon: #6B7280;
  --ff-pad-x: 12px;
}

.mat-mdc-form-field.mat-form-field-appearance-outline {
  margin: 0 !important;
  padding: 0 !important;
  display: flex;
}

.mat-mdc-form-field.mat-form-field-appearance-outline .mat-mdc-text-field-wrapper {
  background: var(--ff-bg);
  padding: 0 !important;
  display: flex;
  align-items: center;
}

.mat-mdc-form-field.mat-form-field-appearance-outline .mat-mdc-form-field-infix {
  min-height: 0 !important;
  height: var(--ff-h) !important;
  display: flex;
  align-items: center;
  padding: 0 var(--ff-pad-x) !important;
  background: var(--ff-bg);
}

.mat-mdc-form-field.mat-form-field-appearance-outline input.mat-mdc-input-element {
  font-size: var(--ff-fs) !important;
  line-height: var(--ff-h) !important;
  height: 100% !important;
  padding: 0 !important;
  margin: 0 !important;
  color: var(--ff-text) !important;
}

.mat-mdc-form-field.mat-form-field-appearance-outline .mat-mdc-form-field-subscript-wrapper {
  display: none !important;
}

.mat-mdc-form-field.mat-form-field-appearance-outline .mdc-notched-outline__leading,
.mat-mdc-form-field.mat-form-field-appearance-outline .mdc-notched-outline__notch,
.mat-mdc-form-field.mat-form-field-appearance-outline .mdc-notched-outline__trailing {
  border-color: var(--ff-border) !important;
  border-width: 1px !important;
}

.mat-mdc-form-field.mat-form-field-appearance-outline.mat-focused .mdc-notched-outline__leading,
.mat-mdc-form-field.mat-form-field-appearance-outline.mat-focused .mdc-notched-outline__notch,
.mat-mdc-form-field.mat-form-field-appearance-outline.mat-focused .mdc-notched-outline__trailing {
  border-color: var(--ff-border-focus) !important;
  border-width: 1px !important;
}

.mat-mdc-form-field.mat-form-field-appearance-outline .mdc-notched-outline {
  border-radius: var(--ff-radius);
}

.mat-mdc-form-field.mat-form-field-appearance-outline .mdc-notched-outline__leading {
  border-top-left-radius: var(--ff-radius);
  border-bottom-left-radius: var(--ff-radius);
}

.mat-mdc-form-field.mat-form-field-appearance-outline .mdc-notched-outline__trailing {
  border-top-right-radius: var(--ff-radius);
  border-bottom-right-radius: var(--ff-radius);
}

.mat-mdc-form-field.mat-form-field-appearance-outline .mat-mdc-form-field-focus-overlay {
  background: transparent !important;
}

.mat-mdc-form-field.mat-form-field-appearance-outline
.mat-mdc-form-field-icon-prefix mat-icon,
.mat-mdc-form-field.mat-form-field-appearance-outline
.mat-mdc-form-field-icon-suffix mat-icon,
.mat-mdc-form-field.mat-form-field-appearance-outline
.mat-datepicker-toggle,
.mat-mdc-form-field.mat-form-field-appearance-outline
.mat-mdc-icon-button,
.mat-mdc-form-field.mat-form-field-appearance-outline
.mat-datepicker-toggle svg,
.mat-mdc-form-field.mat-form-field-appearance-outline
.mat-mdc-icon-button svg {
  color: var(--ff-icon) !important;
}

/* Force select arrow color to grey even when invalid */
.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-invalid .mat-mdc-select-arrow,
.mat-form-field-invalid:not(.mat-form-field-disabled) .mat-mdc-select .mat-mdc-select-arrow {
  color: var(--ff-icon) !important;
}

/* --- TEXTAREA exceptions (déjà présentes) --- */
.mat-mdc-form-field.mat-form-field-appearance-outline:has(textarea.mat-mdc-input-element)
.mat-mdc-text-field-wrapper {
  align-items: flex-start;
  overflow: visible !important;
}

.mat-mdc-form-field.mat-form-field-appearance-outline:has(textarea.mat-mdc-input-element)
.mat-mdc-form-field-infix {
  height: auto !important;
  min-height: 0 !important;
  display: block !important;
  padding: 8px var(--ff-pad-x) !important;
}

.mat-mdc-form-field.mat-form-field-appearance-outline textarea.mat-mdc-input-element {
  height: auto !important;
  line-height: 1.5 !important;
  resize: vertical;
  font-size: var(--ff-fs) !important;
  color: var(--ff-text) !important;
}

/* --- CHIPS exceptions (NOUVEAU) --- */

/* Le wrapper ne doit pas centrer verticalement, ni être figé en hauteur */
.mat-mdc-form-field.mat-form-field-appearance-outline:has(.mat-mdc-chip-grid)
.mat-mdc-text-field-wrapper {
  align-items: flex-start !important;
  height: auto !important;
  overflow: visible !important;
}

/* L'infix doit pouvoir grandir pour contenir grid + input */
.mat-mdc-form-field.mat-form-field-appearance-outline:has(.mat-mdc-chip-grid)
.mat-mdc-form-field-infix {
  height: auto !important;
  min-height: 0 !important;
  display: block !important;
  padding: 8px var(--ff-pad-x) !important;
}

/* Les chips doivent pouvoir aller à la ligne */
.mat-mdc-form-field:has(.mat-mdc-chip-grid)
.mdc-evolution-chip-set__chips {
  flex-wrap: wrap !important;
}

/* L’input d’appoint à côté des chips doit rester “naturel” */
.mat-mdc-form-field:has(.mat-mdc-chip-grid)
input.mat-mdc-input-element {
  height: auto !important;
  line-height: 1.4 !important;
  padding: 0 !important;
  margin: 0 !important;
  font-size: var(--ff-fs) !important;
  color: var(--ff-text) !important;
}

/* Remplace la règle globale "fixe la hauteur" par une version qui IGNORE les chips et les textarea */
.mat-mdc-form-field.mat-form-field-appearance-outline:not(:has(textarea.mat-mdc-input-element)):not(:has(.mat-mdc-chip-grid))
.mat-mdc-form-field-infix {
  height: var(--ff-h) !important;
  display: flex;
  align-items: center;
}

/* === Buttons (global style) === */
.mat-mdc-button,
.mat-mdc-unelevated-button,
.mat-mdc-raised-button,
.mat-mdc-outlined-button {
  border-radius: 8px !important;
  min-width: auto !important;
  padding: 0 20px !important;
  height: 40px !important;
  line-height: 40px !important;
}

.mat-mdc-icon-button {
  border-radius: 8px !important;
}

/* === Button Toggle (segmented controls) === */
.mat-button-toggle-group {
  border: none !important;
  box-shadow: none !important;
}

.mat-button-toggle {
  border: 1px solid #D1D5DB !important;
  color: #374151 !important;
  background-color: white !important;
  transition: border-color 0.2s ease;

  &.mat-button-toggle-checked,
  &.selected {
    background-color: white !important;
    color: #374151 !important;
    border-color: var(--color-primary) !important;
  }

  .mat-button-toggle-label-content {
    line-height: 1 !important;
    padding: 0 !important;
  }

  .mat-pseudo-checkbox {
    display: none !important;
  }

  mat-icon {
    font-size: 1.25rem;
    width: 1.25rem;
    height: 1.25rem;
  }
}

/* === Buttons (secondary variant) === */
.secondary {
  @include mat.button-overrides((
    filled-container-color: var(--color-secondary),
  ));
}

/* === Force color on mat-icon with inline style === */
.mat-mdc-form-field .mat-mdc-form-field-icon-prefix mat-icon.icon-colored {
  color: var(--icon-color, currentColor) !important;
  padding-right: 0.25rem !important;
  margin-right: 0 !important;
}

/* === Icon selector field animation === */
.mat-mdc-form-field.icon-selector-field {
  width: 100%;
  transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.mat-mdc-form-field.icon-selector-field.icon-selected {
  width: 3rem !important;
}

.mat-mdc-form-field.icon-selector-field input[readonly] {
  width: 0 !important;
  min-width: 0 !important;
  opacity: 0 !important;
  transition: opacity 0.2s ease-in-out, width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.mat-mdc-form-field.icon-selector-field:not(.icon-selected) input {
  opacity: 1 !important;
  transition: opacity 0.3s ease-in-out 0.1s, width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}


