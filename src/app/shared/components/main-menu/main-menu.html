<nav class="relative flex items-center justify-between gap-4 px-4 md:px-8 py-3 bg-white border-b border-neutral-200 shadow-md">
  <div class="text-sm flex-shrink-0">
    <span class="font-medium text-neutral-800">mohand</span>
    <span class="text-primary"> boudjema</span>
  </div>

  <div class="hidden md:flex flex-1 items-center justify-center gap-6">
    @for (item of menuItems; track item) {
      <app-menu-item [menuEntry]="item" variant="public"/>
    }
  </div>

  <div class="hidden md:flex items-center gap-4">
    @if (isAuth()) {
      <div class="shrink-0 flex items-center gap-4">
        <span class="text-sm font-medium text-neutral-800">
          {{ greeting() }}, {{ firstName() }}
        </span>
        @if (isVerified()) {
          <mat-icon class="!text-green-600 !text-base !w-4 !h-4" title="Email vérifié">verified</mat-icon>
        }
        @if (achievements(); as ach) {
          <div class="flex items-center gap-3">
            <div class="relative flex items-center justify-center w-[32px] h-[32px]">
              <svg class="absolute" width="32" height="32" viewBox="0 0 32 32">
                <circle
                  cx="16"
                  cy="16"
                  r="12"
                  fill="none"
                  stroke="#e5e7eb"
                  stroke-width="8"
                  stroke-linecap="round"
                />
                <circle
                  cx="16"
                  cy="16"
                  r="12"
                  fill="none"
                  stroke="#f59f0a"
                  stroke-width="8"
                  stroke-linecap="round"
                  [attr.stroke-dasharray]="12 * 2 * 3.14159"
                  [attr.stroke-dashoffset]="12 * 2 * 3.14159 * (1 - ach.percentCompletion / 100)"
                  style="transform: rotate(-90deg); transform-origin: center;"
                />
              </svg>
              <mat-icon class="absolute !leading-none !text-amber-600 !text-[14px] !w-4 !h-4">emoji_events</mat-icon>
            </div>
            <span class="text-sm font-semibold text-amber-600">{{ ach.percentCompletion }}%</span>
          </div>
        }
      </div>
    } @else {
      <button (click)="openAuthModal()" matButton="outlined" class="shrink-0 !border-primary !text-primary">
        S'identifier
      </button>
    }
  </div>

  <div class="flex md:hidden items-center gap-3 flex-1 justify-end">
    @if (isAuth()) {
      <div class="flex items-center gap-2 flex-1 min-w-0">
        <span class="text-xs font-medium text-neutral-800 truncate">
          {{ greeting() }}, {{ firstName() }}
        </span>
        @if (isVerified()) {
          <mat-icon class="!text-green-600 !text-sm !w-4 !h-4 flex-shrink-0" title="Email vérifié">verified</mat-icon>
        }
        @if (achievements(); as ach) {
          <div class="flex items-center gap-1.5 flex-shrink-0">
            <div class="relative flex items-center justify-center w-[24px] h-[24px]">
              <svg class="absolute" width="24" height="24" viewBox="0 0 24 24">
                <circle
                  cx="12"
                  cy="12"
                  r="9"
                  fill="none"
                  stroke="#e5e7eb"
                  stroke-width="6"
                  stroke-linecap="round"
                />
                <circle
                  cx="12"
                  cy="12"
                  r="9"
                  fill="none"
                  stroke="#f59f0a"
                  stroke-width="6"
                  stroke-linecap="round"
                  [attr.stroke-dasharray]="9 * 2 * 3.14159"
                  [attr.stroke-dashoffset]="9 * 2 * 3.14159 * (1 - ach.percentCompletion / 100)"
                  style="transform: rotate(-90deg); transform-origin: center;"
                />
              </svg>
              <mat-icon class="absolute !leading-none !text-amber-600 !text-[11px] !w-3 !h-3">emoji_events</mat-icon>
            </div>
            <span class="text-xs font-semibold text-amber-600">{{ ach.percentCompletion }}%</span>
          </div>
        }
      </div>
    }
    <button (click)="toggleMobileMenu()" mat-icon-button class="flex-shrink-0">
      <mat-icon>{{ mobileMenuOpen() ? 'close' : 'menu' }}</mat-icon>
    </button>
  </div>

  @if (mobileMenuOpen()) {
    <div class="mobile-menu-dropdown absolute top-full left-0 right-0 bg-white border-b border-neutral-200 shadow-lg md:hidden z-50">
      <div class="flex flex-col py-2">
        @for (item of menuItems; track item) {
          <div (click)="closeMobileMenu()">
            <app-menu-item [menuEntry]="item" variant="public" class="w-full"/>
          </div>
        }
        @if (!isAuth()) {
          <div class="px-4 py-3 border-t border-neutral-200">
            <button (click)="openAuthModal(); closeMobileMenu()" mat-flat-button color="primary" class="w-full">
              S'identifier
            </button>
          </div>
        }
      </div>
    </div>
  }
</nav>
