<nav
  class="relative flex items-center justify-between gap-4 px-4 md:px-8 py-3 bg-white border-b border-neutral-200 shadow-md">
  <div class="hidden md:block text-sm flex-shrink-0">
    <span class="font-medium text-neutral-800">mohand</span>
    <span class="text-primary"> boudjema</span>
  </div>

  <div class="hidden md:flex flex-1 items-center justify-center gap-6">
    @for (item of menuItems; track item) {
      <app-menu-item [menuEntry]="item"/>
    }
  </div>

  <div class="hidden md:flex items-center gap-4">
    @if (isAuth()) {
      <a routerLink="/profil"
         class="shrink-0 flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity">
        <span class="text-sm font-medium text-neutral-800">
          {{ greeting() }}, {{ firstName() }}
        </span>
        @if (isVerified()) {
          <mat-icon class="!text-green-600 !text-base !leading-none !w-4 !h-4 flex-shrink-0" matTooltip="Email vérifié">
            verified
          </mat-icon>
        } @else {
          <mat-icon class="!text-amber-600 !text-base !leading-none !w-4 !h-4 flex-shrink-0"
                    [matTooltip]="verificationMessage() || 'Email non vérifié - Vérifiez votre boîte mail'">
            error_outline
          </mat-icon>
        }
        @if (achievements(); as ach) {
          <div class="flex items-center gap-3">
            <div class="relative flex items-center justify-center w-[36px] h-[36px]">
              <svg class="absolute" width="36" height="36" viewBox="0 0 36 36">
                <circle
                  cx="18"
                  cy="18"
                  r="14"
                  fill="none"
                  [attr.stroke]="getProgressBgColor()"
                  stroke-width="8"
                  stroke-linecap="round"
                />
                <circle
                  cx="18"
                  cy="18"
                  r="14"
                  fill="none"
                  stroke="#f59f0a"
                  stroke-width="8"
                  stroke-linecap="round"
                  [attr.stroke-dasharray]="14 * 2 * 3.14159"
                  [attr.stroke-dashoffset]="14 * 2 * 3.14159 * (1 - ach.percentCompletion / 100)"
                  style="transform: rotate(-90deg); transform-origin: center;"
                />
              </svg>
              <mat-icon class="absolute !leading-none !text-amber-600 !text-base !w-4 !h-4">emoji_events</mat-icon>
            </div>
            <span class="text-sm font-semibold text-amber-600">{{ ach.percentCompletion }}%</span>
          </div>
        }
      </a>
    } @else {
      <button (click)="openAuthModal()" matButton="outlined" class="shrink-0 !border-primary !text-primary">
        S'identifier
      </button>
    }
  </div>

  <div class="flex md:hidden items-center w-full">
    @if (isAuth()) {
      <a routerLink="/profil"
         class="flex items-center gap-2 flex-1 min-w-0 cursor-pointer hover:opacity-80 transition-opacity">
        <div class="flex items-center gap-2 flex-shrink-0">
          @if (achievements(); as ach) {
            <div class="flex items-center gap-2">
              <div class="relative flex items-center justify-center w-[36px] h-[36px]">
                <svg class="absolute" width="36" height="36" viewBox="0 0 36 36">
                  <circle
                    cx="18"
                    cy="18"
                    r="14"
                    fill="none"
                    [attr.stroke]="getProgressBgColor()"
                    stroke-width="8"
                    stroke-linecap="round"
                  />
                  <circle
                    cx="18"
                    cy="18"
                    r="14"
                    fill="none"
                    stroke="#f59f0a"
                    stroke-width="8"
                    stroke-linecap="round"
                    [attr.stroke-dasharray]="14 * 2 * 3.14159"
                    [attr.stroke-dashoffset]="14 * 2 * 3.14159 * (1 - ach.percentCompletion / 100)"
                    style="transform: rotate(-90deg); transform-origin: center;"
                  />
                </svg>
                <mat-icon class="!leading-none !text-amber-600 !text-base !w-4 !h-4">emoji_events</mat-icon>
              </div>
              <span class="text-sm font-semibold text-amber-600">{{ ach.percentCompletion }}%</span>
            </div>
          }
        </div>
        <div class="flex items-center gap-2 flex-1 min-w-0 mx-3">
          <span class="text-sm font-medium text-neutral-800 truncate">
            {{ greeting() }}, {{ firstName() }}
          </span>
          @if (isVerified()) {
            <mat-icon class="!text-green-600 !text-base !w-4 !h-4 !leading-none flex-shrink-0"
                      matTooltip="Email vérifié">verified
            </mat-icon>
          } @else {
            <mat-icon class="!text-amber-600 !text-base !w-4 !h-4 !leading-none flex-shrink-0"
                      [matTooltip]="verificationMessage() || 'Email non vérifié - Vérifiez votre boîte mail'">
              error_outline
            </mat-icon>
          }
        </div>
      </a>
    }
    <button (click)="toggleMobileMenu()" mat-icon-button class="flex-shrink-0 ml-auto">
      <mat-icon>{{ mobileMenuOpen() ? 'close' : 'menu' }}</mat-icon>
    </button>
  </div>

  @if (mobileMenuOpen()) {
    <div
      class="mobile-menu-dropdown absolute top-full left-0 right-0 bg-white border-b border-neutral-200 shadow-lg md:hidden z-50">
      <div class="flex flex-col py-2 px-4 gap-1">
        @for (item of menuItems; track item) {
          <div (click)="closeMobileMenu()" class="mobile-menu-item">
            <app-menu-item [menuEntry]="item"/>
          </div>
        }
        @if (!isAuth()) {
          <div class="py-3 border-t border-neutral-200 mt-2">
            <button (click)="openAuthModal(); closeMobileMenu()" mat-flat-button color="primary" class="w-full">
              S'identifier
            </button>
          </div>
        }
      </div>
    </div>
  }
</nav>
