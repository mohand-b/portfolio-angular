<div class="min-h-full p-8">
  <div class="max-w-7xl mx-auto">
    @if (loading()) {
      <div class="text-center py-16">
        <p class="text-neutral-500">Chargement...</p>
      </div>
    } @else if (project()) {
      <button (click)="goBack()" class="flex items-center gap-2 text-primary cursor-pointer mb-8 ">
        <mat-icon class="!text-xl !leading-none">arrow_back</mat-icon>
        <span class="font-medium">Retour aux projets</span>
      </button>

      <header class="mb-10">
        <h1 class="text-4xl font-bold text-neutral-800 mb-5">{{ project()!.title }}</h1>

        <div class="flex flex-wrap gap-2 mb-5">
          @for (type of project()!.projectTypes; track type) {
            <span class="px-3 py-1.5 text-sm font-medium rounded-lg chip-purple">{{ type }}</span>
          }
          @if (project()!.market) {
            <span class="px-3 py-1.5 text-sm font-medium rounded-lg chip-blue">{{ project()!.market }}</span>
          }
          @if (project()!.scope) {
            <span class="px-3 py-1.5 text-sm font-medium rounded-lg chip-green">{{ project()!.scope }}</span>
          }
        </div>

        @if (project()!.job) {
          <div class="flex items-center gap-3">
            @if (project()!.job!.logo) {
              <img [src]="project()!.job!.logo" [alt]="project()!.job!.company"
                   class="w-10 h-10 object-contain rounded-sm">
            }
            <div class="flex items-center gap-1">
              <span class="text-gray-600">Réalisé chez</span>
              <span class="font-semibold text-primary">{{ project()!.job!.company }}</span>
            </div>
          </div>
        } @else {
          <div class="text-gray-600">
            <span>Projet personnel réalisé du {{ project()!.startDate | date:'MM/yyyy' }}</span>
            @if (project()!.endDate) {
              <span> → {{ project()!.endDate | date:'MM/yyyy' }}</span>
            } @else {
              <span> → Aujourd'hui</span>
            }
          </div>
        }
      </header>

      @if (project()!.description) {
        <section class="mb-10">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <div class="w-1 h-6 bg-primary rounded-full"></div>
            Description
          </h2>
          <p class="text-gray-700 leading-relaxed">{{ project()!.description }}</p>
        </section>
      }

      @if (project()!.collaboration || (project()!.missions && project()!.missions.length > 0)) {
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-10 mb-10">
          <div class="lg:col-span-3 space-y-10">
            @if (project()!.collaboration) {
              <section>
                <h2 class="text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
                  <div class="w-1 h-6 bg-primary rounded-full"></div>
                  Contexte & Collaboration
                </h2>
                <p class="text-gray-700 leading-relaxed">{{ project()!.collaboration }}</p>
              </section>
            }

            @if (project()!.missions && project()!.missions.length > 0) {
              <section>
                <h2 class="text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
                  <div class="w-1 h-6 bg-primary rounded-full"></div>
                  Missions
                </h2>
                <ul class="space-y-3">
                  @for (mission of project()!.missions; track mission) {
                    <li class="flex gap-3 items-center">
                      <mat-icon class="!text-xl !leading-none !text-green-600 flex-shrink-0">check_circle</mat-icon>
                      <span class="text-gray-700 text-base leading-relaxed flex-1">{{ mission }}</span>
                    </li>
                  }
                </ul>
              </section>
            }
          </div>

          @if (project()!.skills && project()!.skills.length > 0) {
            <aside class="lg:col-span-1 lg:sticky lg:top-8 lg:self-start lg:border-l lg:border-gray-200 lg:pl-10">
              <h2 class="text-2xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
                <div class="w-1 h-6 bg-primary rounded-full"></div>
                Compétences
              </h2>
              <div class="flex flex-col gap-6">
                @for (categoryGroup of getSkillsByCategory(); track categoryGroup[0]) {
                  <div class="flex flex-col gap-3">
                    <div class="flex items-center gap-2">
                      <mat-icon class="!text-lg !leading-none" [style.color]="getCategoryMeta(categoryGroup[0]).color">
                        {{ getCategoryMeta(categoryGroup[0]).icon }}
                      </mat-icon>
                      <h3 class="text-xs font-semibold text-gray-700 uppercase tracking-wide">
                        {{ getCategoryMeta(categoryGroup[0]).label }}
                      </h3>
                    </div>
                    <div class="flex flex-wrap gap-2">
                      @for (skill of categoryGroup[1]; track skill.id) {
                        <span class="px-3 py-1.5 text-sm font-medium rounded-full"
                              [style.background-color]="getCategoryMeta(skill.category).color + '15'"
                              [style.color]="getCategoryMeta(skill.category).color">
                          {{ skill.name }}
                        </span>
                      }
                    </div>
                  </div>
                }
              </div>
            </aside>
          }
        </div>
      } @else {
        @if (project()!.skills && project()!.skills.length > 0) {
          <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
              <div class="w-1 h-6 bg-primary rounded-full"></div>
              Technologies & Compétences
            </h2>
            <div class="flex flex-col gap-6">
              @for (categoryGroup of getSkillsByCategory(); track categoryGroup[0]) {
                <div class="flex flex-col gap-3">
                  <div class="flex items-center gap-2">
                    <mat-icon class="!text-lg !leading-none" [style.color]="getCategoryMeta(categoryGroup[0]).color">
                      {{ getCategoryMeta(categoryGroup[0]).icon }}
                    </mat-icon>
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide">
                      {{ getCategoryMeta(categoryGroup[0]).label }}
                    </h3>
                  </div>
                  <div class="flex flex-wrap gap-2">
                    @for (skill of categoryGroup[1]; track skill.id) {
                      <span class="px-3 py-1.5 text-sm font-medium rounded-full"
                            [style.background-color]="getCategoryMeta(skill.category).color + '15'"
                            [style.color]="getCategoryMeta(skill.category).color">
                        {{ skill.name }}
                      </span>
                    }
                  </div>
                </div>
              }
            </div>
          </section>
        }
      }

      @if (images().length > 0) {
        <section class="mb-10">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <div class="w-1 h-6 bg-primary rounded-full"></div>
            Galerie
          </h2>

          <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <div class="relative w-full h-80 bg-gray-50">
              <img [src]="images()[currentImageIndex()]" [alt]="project()!.title"
                   class="w-full h-full object-contain p-4">
            </div>

            @if (images().length > 1) {
              <div class="p-4 flex gap-3 overflow-x-auto">
                @for (img of images(); track $index) {
                  <button (click)="goToImage($index)"
                          class="flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all hover:scale-105"
                          [class.border-primary]="currentImageIndex() === $index"
                          [class.border-gray-200]="currentImageIndex() !== $index">
                    <img [src]="img" [alt]="'Image ' + ($index + 1)" class="w-full h-full object-cover">
                  </button>
                }
              </div>
            }
          </div>
        </section>
      }
    }
  </div>
</div>
