<div class="bg-white rounded-lg border border-neutral-200 p-6">
  <h2 class="text-2xl font-bold text-neutral-800 mb-6">Questions / Réponses</h2>

  <div class="mb-8 pb-8 border-b border-neutral-200">
    @if (!isAuthenticated()) {
      <div class="p-6 rounded-lg bg-blue-50 border border-blue-200 text-center">
        <mat-icon class="!text-4xl !w-10 !h-10 text-blue-600 mb-3">login</mat-icon>
        <p class="text-sm text-blue-800 mb-4">
          Vous devez être identifié pour poser une question
        </p>
        <button type="button" matButton="filled" (click)="openAuthModal()">
          <span class="flex items-center gap-2">
            <mat-icon>person</mat-icon>
            <span>S'identifier</span>
          </span>
        </button>
      </div>
    } @else if (hasPendingQuestion()) {
      <div class="p-6 rounded-lg bg-amber-50 border border-amber-200 text-center">
        <mat-icon class="!text-4xl !w-10 !h-10 text-amber-600 mb-3">schedule</mat-icon>
        <p class="text-sm text-amber-800">
          Une question à la fois. Veuillez attendre une réponse avant d'en poser une nouvelle.
        </p>
      </div>
    } @else {
      <form [formGroup]="form" (submit)="onSubmit()" class="flex flex-col gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Votre question</label>
          <mat-form-field appearance="outline" class="w-full">
            <textarea matInput formControlName="content" rows="4" placeholder="Posez-moi une question..."></textarea>
          </mat-form-field>
        </div>

        <div class="flex items-center gap-3 p-3 rounded-lg bg-neutral-50 border border-neutral-200">
          <mat-slide-toggle formControlName="isAnonymous"></mat-slide-toggle>
          <div class="flex flex-col">
            <span class="text-sm font-medium text-neutral-800">Question anonyme</span>
            <span class="text-xs text-neutral-600">
              {{ form.get('isAnonymous')?.value ? 'Votre nom ne sera pas visible' : 'Votre nom sera affiché avec la question' }}
            </span>
          </div>
        </div>

        @if (submitError()) {
          <app-alert-message type="error" [message]="submitError()!" />
        }

        <div class="flex justify-end">
          <button type="submit" matButton="filled" [disabled]="form.invalid || isSubmitting()">
            <span class="flex items-center gap-2">
              <mat-icon>{{ isSubmitting() ? 'hourglass_empty' : 'help' }}</mat-icon>
              <span>{{ isSubmitting() ? 'Envoi...' : 'Poser ma question' }}</span>
            </span>
          </button>
        </div>
      </form>
    }
  </div>

  <div class="flex flex-col gap-4">
    <h3 class="text-lg font-semibold text-neutral-800">Questions publiques</h3>

    @if (isLoadingQuestions()) {
      <p class="text-center py-8 text-neutral-500">Chargement des questions...</p>
    } @else if (questions().length === 0) {
      <p class="text-center py-8 text-neutral-500">Aucune question pour le moment</p>
    } @else {
      @for (question of questions(); track question.id) {
        <div class="border border-neutral-200 rounded-lg p-4">
          <div class="flex items-start justify-between gap-3 mb-3">
            <span class="text-sm font-medium {{ isMyQuestion(question) ? 'text-neutral-800' : 'text-neutral-600' }}">
              @if (question.isAnonymous && !isMyQuestion(question)) {
                Anonyme
              } @else if (isMyQuestion(question)) {
                Vous
              } @else {
                Visiteur
              }
            </span>

            <span class="text-xs px-2 py-1 rounded-full border {{ getStatusColor(question.status) }}">
              {{ getStatusLabel(question.status) }}
            </span>
          </div>

          <p class="text-sm text-neutral-700 mb-3">{{ question.content }}</p>

          @if (question.status === QuestionStatusEnum.ANSWERED && question.answer) {
            <div class="bg-primary/5 border-l-4 border-primary pl-4 py-3 mt-3">
              <p class="text-sm font-medium text-primary mb-1">Réponse :</p>
              <p class="text-sm text-neutral-700">{{ question.answer }}</p>
            </div>
          }

          @if (question.status === QuestionStatusEnum.REJECTED && question.rejectionReason && isMyQuestion(question)) {
            <div class="bg-red-50 border-l-4 border-red-400 pl-4 py-3 mt-3">
              <p class="text-sm font-medium text-red-700 mb-1">Motif du refus :</p>
              <p class="text-sm text-red-600">{{ question.rejectionReason }}</p>
            </div>
          }

          <p class="text-xs text-neutral-400 mt-2">{{ question.createdAt | date: 'dd/MM/yyyy à HH:mm' }}</p>
        </div>
      }
    }
  </div>
</div>
