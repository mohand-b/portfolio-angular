<div class="relative flex justify-center max-lg:justify-start items-center mb-12 w-full">
  <div
    class="flex-1 max-w-[calc(50%-16px)] max-lg:hidden"
    [class.order-3]="isLeft()"
    [class.order-1]="!isLeft()"
  ></div>
  <div class="relative flex justify-center items-center w-8 shrink-0 z-[2] order-2 max-lg:order-1">
    <div
      class="w-8 h-8 rounded-full flex items-center justify-center shadow-[0_0_0_2px_white]"
      [style.background-color]="getTypeMeta(item().type).color"
    >
      <mat-icon class="!text-white !text-base !w-4 !h-4 !leading-none">{{ getTypeMeta(item().type).icon }}</mat-icon>
    </div>
  </div>
  <div
    class="flex-1 max-w-[calc(50%-16px)] max-lg:max-w-full flex items-start max-lg:order-2 max-lg:justify-start max-lg:!pl-6 max-lg:!pr-0"
    [class.order-1]="isLeft()"
    [class.order-3]="!isLeft()"
    [class.pr-6]="isLeft()"
    [class.pl-6]="!isLeft()"
    [class.justify-end]="isLeft()"
    [class.justify-start]="!isLeft()"
  >
    <div
      class="bg-white rounded-lg p-5 shadow-sm max-w-[550px] w-full text-left max-lg:!border-l-[3px] max-lg:!border-r-0"
      [class.border-l-[3px]]="!isLeft()"
      [class.border-r-[3px]]="isLeft()"
      [style.border-color]="getTypeMeta(item().type).color"
    >
      <div class="flex justify-between items-start gap-3 mb-2">
        <span
          class="inline-block py-0.5 px-2.5 rounded text-[0.7rem] font-medium text-white whitespace-nowrap shrink-0 opacity-90"
          [style.background-color]="getTypeMeta(item().type).color"
        >
          {{ getTypeMeta(item().type).label }}
        </span>
        <div class="relative">
          <span class="flex items-center gap-1 text-neutral-600 text-[0.75rem]">
            {{ item().startDate | date:'MMM yyyy' }}
            <mat-icon class="!text-xs !w-3 !h-3 !leading-none text-neutral-400">east</mat-icon>
            @if (item().endDate) {
              {{ item().endDate | date:'MMM yyyy' }}
            } @else {
              Aujourd'hui
            }
          </span>
          @if (getDuration(item().startDate, item().endDate)) {
            <span class="absolute top-full right-0 text-neutral-500 font-bold text-[0.75rem] whitespace-nowrap">
              {{ getDuration(item().startDate, item().endDate) }}
            </span>
          }
        </div>
      </div>

      @if (item().type === 'job' || item().type === 'education') {
        <div class="flex items-center gap-2 pt-1">
          <img src="{{ item().image }}" alt="{{ item().title }}" class="w-12 h-12 rounded-xs object-cover"/>
          <div class="flex-1">
            <h3 class="text-base font-medium text-neutral-800">{{ item().title }}</h3>
            <div class="flex items-center gap-1.5 text-neutral-600 text-[0.8125rem]">
              <mat-icon class="!text-base !w-4 !h-4 !leading-none text-neutral-400">business</mat-icon>
              <span class="text-primary">{{ $any(item()).company || $any(item()).institution }}</span>
              <span>à {{ $any(item()).location }}</span>
            </div>
          </div>
        </div>

        @if (item().type === TimelineItemType.Education && $any(item()).certifications?.length > 0) {
          <div class="flex flex-col gap-1.5 mt-3">
            @for (certGroup of getCertificationsByType($any(item())); track certGroup.type) {
              <div class="flex items-center gap-2 text-sm">
                <mat-icon
                  class="!text-base !w-4 !h-4 !leading-none flex-shrink-0"
                  [style.color]="typeMeta[TimelineItemType.Education].color"
                >
                  {{ certGroup.icon }}
                </mat-icon>
                <span class="text-neutral-700">{{ certGroup.titles.join(', ') }}</span>
              </div>
            }
          </div>
        }
      }

      @if (item().type === 'project') {
        <h3 class="m-0 mb-3 text-base font-medium text-neutral-800">{{ item().title }}</h3>

        <div class="flex flex-wrap gap-1.5 mb-3">
          @for (type of $any(item()).projectTypes; track type) {
            <span class="px-2 py-1 text-xs font-medium rounded-md bg-purple-100 text-purple-700">
              {{ type }}
            </span>
          }
          <span class="px-2 py-1 text-xs font-medium rounded-md bg-blue-100 text-blue-700">
            {{ $any(item()).market }}
          </span>
          <span class="px-2 py-1 text-xs font-medium rounded-md bg-green-100 text-green-700">
            {{ $any(item()).scope }}
          </span>
        </div>

        @if (item().description) {
          <p class="text-sm text-neutral-700 leading-relaxed mb-3 line-clamp-2">{{ item().description }}</p>
        }

        @if ($any(item()).skills && $any(item()).skills.length > 0) {
          <div class="pt-3 border-t border-neutral-200">
            <div class="text-xs font-medium text-neutral-600 mb-2">Compétences mises en application :</div>
            <div class="flex flex-wrap gap-1.5">
              @for (skillGroup of getSkillsByCategory($any(item())); track skillGroup.category) {
                <span
                  class="inline-flex items-center gap-1 py-1 px-2.5 rounded-full text-xs"
                  [style.background-color]="hexToRgba(skillGroup.color, 0.1)"
                  [style.color]="skillGroup.color"
                  [style.border-color]="hexToRgba(skillGroup.color, 0.2)"
                >
                  <mat-icon class="!text-sm !w-3.5 !h-3.5 !leading-none" [style.color]="skillGroup.color">
                    {{ skillGroup.icon }}
                  </mat-icon>
                  {{ skillGroup.shortLabel }} <strong class="font-bold">{{ skillGroup.count }}</strong>
                </span>
              }
            </div>
          </div>
        }
      }

      @if (item().type === TimelineItemType.Education || item().type === TimelineItemType.Job) {
        <div class="flex items-center justify-end gap-2 text-slate-400 mt-4 pt-3 border-t border-neutral-200">
          <button
            class="flex items-center cursor-pointer hover:text-slate-600 transition-colors"
            (click)="editRequested.emit(item().id)"
          >
            <mat-icon class="!text-lg">edit</mat-icon>
          </button>
          <button
            class="flex items-center cursor-pointer hover:text-rose-600 transition-colors"
            (click)="deleteRequested.emit(item().id)"
          >
            <mat-icon class="!text-lg">delete</mat-icon>
          </button>
        </div>
      }
    </div>
  </div>
</div>
