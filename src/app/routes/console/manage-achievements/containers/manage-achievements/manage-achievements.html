<div class="flex flex-col h-full">
  <div
    class="sticky top-0 z-10 flex items-center justify-between min-h-[5rem] px-[1.25rem] border-b border-neutral-200 bg-white"
  >
    <h1 class="text-2xl font-semibold text-neutral-800">Achievements</h1>

    <button (click)="openPanel()" matButton="filled">
      <mat-icon>add</mat-icon>
      Créer un nouveau succès
    </button>
  </div>

  <div class="flex flex-col flex-1 gap-[1.5rem] bg-neutral-100 p-[1.25rem]">

    <section class="grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-4">
      <app-kpi-card
        title="Total Succès"
        [value]="totalAchievements()"
        icon="emoji_events"
        color="#ebb207"/>

      <app-kpi-card
        title="Actifs"
        [value]="totalActiveAchievements()"
        icon="check_circle"
        color="#21c45d"/>

      <app-kpi-card
        title="Total Débloqués"
        [value]="achievementStats()?.totalUnlocked!"
        icon="lock_open"
        color="#3b82f5"/>

      <app-kpi-card
        title="Taux Complétion"
        [value]="achievementStats()?.completionRate!+'%'"
        icon="pie_chart"
        color="#a854f7"/>
    </section>

    <section class="grid gap-6
                  grid-cols-1
                  sm:grid-cols-2
                  xl:grid-cols-3">
      @for (achievement of achievements(); track achievement.id) {
        <app-achievement-item
          [achievement]="achievement"
          (edit)="onEdit($event)"
          (remove)="onRemove($event)"/>
      }
    </section>
  </div>
</div>

<app-side-panel (closed)="onCloseRequested()" [isOpen]="panelOpen()">
  <app-achievement-form [achievement]="selectedAchievement()" (saved)="onCloseRequested()"/>
</app-side-panel>
